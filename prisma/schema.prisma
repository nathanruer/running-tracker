generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model training_sessions {
  id                String   @id @default(cuid())
  sessionNumber     Int
  week              Int?
  date              DateTime?
  sessionType       String
  duration          String?
  distance          Float?
  avgPace           String?
  avgHeartRate      Int?
  comments          String   @default("")
  createdAt         DateTime @default(now())
  userId            String
  intervalDetails   Json?
  perceivedExertion Int?     @default(0)
  status            String   @default("completed")
  plannedDate       DateTime?
  targetPace        String?
  targetDuration    Int?
  targetDistance    Float?
  targetHeartRateZone String?
  targetHeartRateBpm String?
  targetRPE         Int?
  recommendationId  String?
  externalId        String?
  source            String?  @default("manual")
  stravaData        Json?
  stravaStreams     Json?
  elevationGain     Float?
  maxElevation      Float?
  minElevation      Float?
  averageCadence    Float?
  averageTemp       Float?
  calories          Int?
  weather           Json?

  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([recommendationId])
}

model users {
  id                   String                @id @default(cuid())
  email                String                @unique
  password             String
  createdAt            DateTime              @default(now())
  stravaAccessToken    String?
  stravaId             String?               @unique
  stravaRefreshToken   String?
  stravaTokenExpiresAt DateTime?
  age                  Int?
  maxHeartRate         Int?
  weight               Float?
  vma                  Float?
  goal                 String?               @db.Text
  training_sessions    training_sessions[]
  chat_conversations   chat_conversations[]
}

model chat_conversations {
  id            String          @id @default(cuid())
  title         String
  userId        String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  users         users           @relation(fields: [userId], references: [id], onDelete: Cascade)
  chat_messages chat_messages[]

  @@index([userId])
  @@index([updatedAt])
}

model chat_messages {
  id               String              @id @default(cuid())
  conversationId   String
  role             String
  content          String              @db.Text
  recommendations  Json?
  model            String?
  createdAt        DateTime            @default(now())
  chat_conversations chat_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
}
